<div class="max-w-6xl mx-auto py-8 px-2 text-xs">
  <%= link_to "sign out", destroy_user_session_path, method: :delete %>
  <div class="bg-white border" style="height: calc(100vh - 7em)">
    <div class="flex w-full h-full">
      <aside class="w-1/4 border-r overflow-y-hidden">
        <header class="px-4 border-b flex justify-center" style="min-height: 65px; height: 65px; z-index: 5;">
          <div class="flex justify-between items-center w-full">
            <div>All conversations</div>
            <div class="underline">Search</div>
          </div>
        </header>
        <div class="overflow-y-scroll w-full overflow-x-hidden" style="flex: 1; height: calc(100% - 65px)">
          <% @chat_rooms.each do |room| %>
            <%= link_to chat_path(room.slug) do %>
              <div class="<%= 'bg-green-100' if params[:chat_slug] == room.slug %> p-4 border-b">
                <div class="flex items-start">
                  <img src="<%= room.other_users_in_room(current_user).avatar %>" alt="" class="object-cover w-10 h-10 rounded-full border">
                  <div class="pl-2" style="flex: 1">
                    <div class="flex justify-between mb-1">
                      <div class="font-semibold"><%= room.other_users_in_room(current_user).username %></div>
                      <div class="font-light text-gray-600 text-xs">1 month</div>
                    </div>
                    <div class="flex justify-between items-center">
                      <div class="font-light text-gray-600"><%= room.messages.last.message.truncate(25) %></div>
                      <div class="text-green-400 font-bold"><small>online</small></div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </aside>
      <main style="flex: 1">
        <header class="border-b px-4" style="min-height: 65px; height: 65px; z-index: 5;">
          <div class="flex items-center h-full">
            <div>
              <div class="text-xl font-bold"><%= @recipient.username %> <span class="text-green-400 ml-1 text-sm"><small>online</small></span></div>
              <div class="text-gray-600 flex">
                <div>Last seen 22h ago</div>
                <div class="mx-2">-</div>
                <div>Local time Nov 18, 9:31AM</div>
              </div>
            </div>
          </div>
        </header>
        <div class="flex flex-col" style="height: calc(100% - 65px);">
          <div class="bg-white h-full w-full overflow-x-hidden overflow-y-scroll m-0" >
            <div id="messages-timeline">
              <% @messages.each do |msg| %>
                <%= render 'message', msg: msg %>
              <% end %>
            </div>
            <div data-action="cable-ready:after-morph@document->chat#scroll"></div>
            <div id="auto-scroll-anchor"></div>
          </div>
          <div class="box-border" id="input-area">
            <div class="max-w-xl mx-auto px-4">
                <%= text_area_tag :message, nil, class: "resize-none border w-full rounded shadow text-xs p-2 text-gray-700 flex", style: "flex-grow: 1", id: "text-area-content" %>
                <footer class="px-1 py-3">
                  <div class="flex justify-between items-center">
                    <div class="underline cursor-pointer">Add attachment</div>
                    <%= submit_tag "Send", class: "font-bold text-white py-1 px-3 rounded border text-md bg-green-500 hover:bg-green-700 cursor-pointer", data: { chat_room_id: @chat_room.id, controller: "chat", action: "click->chat#send_message" } %>
                  </div>
                </footer>
            </div>
          </div>
        </div>
      </main>
      <aside class="hidden lg:block w-1/4 border-l overflow-y-auto">
        <header class="p-4">
          <div class="text-lg font-bold">About</div>
          <article class="my-10">
            <div class="flex flex-col items-center">
              <div class="mb-3">
                <div class="flex justify-center">
                  <img src="<%= @recipient.avatar %>" alt="" class="object-cover w-16 h-16 rounded-full border">
                </div>
                <p class="mt-1 text-center text-sm font-bold mb-2"><%= @recipient.username %></p>
                <p class="mt-1 text-center text-sm font-bold mb-2"><%= @recipient.email %></p>
                <p class="mt-1 text-center text-sm font-bold mb-2"><%= @recipient.slug %></p>
                <p class="my-1 text-center"><span class="bg-purple-600 text-white text-center py-1 px-2 shadow rounded">Business</span></p>
              </div>
              <div class="flex justify-between items-center w-full my-1 text-sm">
                <div class="text-gray-700">Reviews</div>
                <div class="text-gray-700 font-semibold">⭐️4.5 <span class="text-gray-500 font-light">(4)</span></div>
              </div>
              <div class="flex justify-between items-center w-full my-1 text-sm">
                <div class="text-gray-700">Industry</div>
                <div class="text-gray-700 font-semibold">Services</div>
              </div>
              <div class="flex justify-between items-center w-full my-1 text-sm">
                <div class="text-gray-700">Specialty</div>
                <div class="text-gray-700 font-semibold">Accounting</div>
              </div>
              <div class="flex justify-between items-center w-full my-1 text-sm">
                <div class="text-gray-700">Company</div>
                <div class="text-gray-700 font-semibold underline text-blue-500 hover:text-blue-700 cursor-pointer">More info</div>
              </div>
            </div>
          </article>
        </header>
      </aside>
    </div>
  </div>
</div>


<script>
  var element_to_scroll_to = document.getElementById('auto-scroll-anchor');
  element_to_scroll_to.scrollIntoView();
</script>
